{
  "hash": "46bd3dc6fcbfa898e900c132258fec4b",
  "result": {
    "markdown": "---\ntitle: \"Loops\"\nengine: knitr\n---\n\n\n## What are loops?\n\nLoops are chunks of code that run repeatedly until a stopping criterion is reached. There are lots of different types of loops that are available, e.g. `while` loops, `repeat` loops, and `for` loops. We will focus on `for` loops as these are the most common type of loop you will need when programming in R.\n\n**NOTE**: it can be better for code efficiency to avoid using loops but often a loop works just fine!\n\n## Structure of for loops\n\nTo loop/iterate through a certain number of repetitions, or carry out the same thing to lots of inputs (e.g. over all columns of a data frame), a `for` loop is used. In R `for` loops take an *iterator variable* and assign it successive values from a sequence or vector. The general structure of a `for` loop is:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfor (iterator_variable in some_vector) {\n    # do something\n}\n```\n:::\n\n\nOften we use `i` to denote the iterator variable name but any name can be used. Each time the loop is run, `i` then changes value as given by the numbers in `some_vector`. Typically `i` increments by 1 (or some integer), but not always.\n\n## A simple for loop\n\nIn the simplest example:\n\n::: {.cell}\n\n```{.r .cell-code}\nfor (i in 1:10) {\n    print(i)\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.outputcode}\n[1] 1\n[1] 2\n[1] 3\n[1] 4\n[1] 5\n[1] 6\n[1] 7\n[1] 8\n[1] 9\n[1] 10\n```\n:::\n:::\n\n\nHere `i` is the iterator variable and the sequence 1, 2, 3, ..., 10 is the vector of values `i` will take on. First `i` is given the value 1, and the code between the curly brackets is executed. Here 1 is printed to the screen.  Once the code is executed, `i` is then incremented to the next value in the sequence 1, 2, 3, ..., 10, i.e. the number 2. The code is executed again and 2 is printed to the screen. The loop repeats until it reaches the final value in the sequence, 10, executes the code and then exits the loop. \n\n## Iterating\n\nThe vector of values to iterate through can have many structures. To print even numbers between 1 and 10 use:  \n\n::: {.cell}\n\n```{.r .cell-code}\nsteps <- c(2, 4, 6, 8, 10)\nfor (i in steps) {\n    print(i)\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.outputcode}\n[1] 2\n[1] 4\n[1] 6\n[1] 8\n[1] 10\n```\n:::\n:::\n\n\nNext say we have a character vector called `char_vec`:\n\n::: {.cell}\n\n```{.r .cell-code}\nchar_vec <- c(\"a\", \"b\", \"c\", \"d\")\n```\n:::\n\n\nTo print the contents of `char_vec` there are several options. The following three loops all have the same behaviour.\n\nIterate directly through `char_vec`:\n\n::: {.cell}\n\n```{.r .cell-code}\n# Loop 1\nfor (i in char_vec) {\n    print(i)\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.outputcode}\n[1] \"a\"\n[1] \"b\"\n[1] \"c\"\n[1] \"d\"\n```\n:::\n:::\n\n    \nDefine a sequence of indices and access each element of `char_vec` using `[ ]`:\n\n::: {.cell}\n\n```{.r .cell-code}\n# Loop 2\nfor (i in 1:4) {\n    print(char_vec[i])\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.outputcode}\n[1] \"a\"\n[1] \"b\"\n[1] \"c\"\n[1] \"d\"\n```\n:::\n:::\n\n\nUse `seq_along()` to automatically create a sequence of indices of the correct length:\n\n::: {.cell}\n\n```{.r .cell-code}\n# Loop 3\nfor (i in seq_along(char_vec)) {\n    print(char_vec[i])\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.outputcode}\n[1] \"a\"\n[1] \"b\"\n[1] \"c\"\n[1] \"d\"\n```\n:::\n:::\n\n\n## Storing outputs\n\nWhen using `for` loops we often want to store the results of the code we are executing in the loop. Typically the results will be stored in specific locations in a vector, data frame, or list depending on the value of `i`. Let's set up a list with 3 elements, each of which is a numeric vector:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat.list <- list(\n    el_1 = c(1, 2, 3, 4, 5),\n    el_2 = c(3.4, 2.3, 3.1, 4),\n    el_3 = c(19.3, 12.5, 6.1)\n)\n```\n:::\n\n\nSay we want to calculate and store the mean of each of the vectors in `dat.list`. A `for` loop can be used to do this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set up an empty numeric vector to store the means. \nmean.vec <- vector(mode = \"numeric\", length = length(dat.list))\n\n# Run the for loop \nfor (i in seq_along(dat.list)) {\n    mean.vec[i] <- mean(dat.list[[i]]) \n}\n\nmean.vec\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.outputcode}\n[1]  3.00000  3.20000 12.63333\n```\n:::\n:::\n\n    \nThere are 3 steps in this process:\n\n1. **Output** - set up an empty object to store the results.  \n2. **Sequence** - set up the iterator variable and the sequencing vector.  \n3. **Body** - write the code to execute.\n    \n## Nested loops\n\n`for` loops can also be *nested*, i.e. we can have multiple loops iterating over different indices. For example, we might want to iterate over the rows and columns of a data frame.\n\nA nested loop is constructed as follows:\n\n::: {.cell}\n\n```{.r .cell-code}\nmy.data.frame <- data.frame(var.1 = 1:6, var.2 = 8:13)\n\nfor (i in 1:nrow(my.data.frame)) {\n    for (j in 1:ncol(my.data.frame)) {\n        print(my.data.frame[i, j])\n    }   \n}\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.outputcode}\n[1] 1\n[1] 8\n[1] 2\n[1] 9\n[1] 3\n[1] 10\n[1] 4\n[1] 11\n[1] 5\n[1] 12\n[1] 6\n[1] 13\n```\n:::\n:::\n\n\n## Implicit looping\n\nR has an in-built family of functions which implement looping in a compact and efficient way. The main functions in this family are:  \n  \n* `lapply()` - loop over a list and evaluate a function on each element\n* `sapply()` - same as `lapply()` by tries to simplify the result\n* `tapply()` - apply a function over subsets of a vector\n* `apply()` - apply a function over the margins of an array\n* `mapply()` - a multivariate version of `lapply()`\n\nTo calculate the mean for each element of the data frame `dat.list` without using a `for` loop:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat.list <- list(\n    el_1 = c(1, 2, 3, 4, 5),\n    el_2 = c(3.4, 2.3, 3.1, 4),\n    el_3 = c(19.3, 12.5, 6.1)\n)\nlapply(dat.list, mean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```{.outputcode}\n$el_1\n[1] 3\n\n$el_2\n[1] 3.2\n\n$el_3\n[1] 12.63333\n```\n:::\n:::\n\n\n\n## Additional resource\n\n\n<br><br>\n\n::: {style=\"font-size: 0.875em;\"}\nBack to [week 01](/weeks/week-1.qmd) ‚èé\n:::",
    "supporting": [
      "08_Loops_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}